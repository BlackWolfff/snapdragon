# {%= name %} {%= badge("fury") %}

> {%= description %}

Created by [jonschlinkert]({%= author.url %}) and [doowb](https://github.com/doowb).

**Features**

- Bootstrap your own parser, get sourcemap support for free
- All parsing and rendering is handled by simple, reusable middleware functions
- Inspired by the parsers in [Jade][] and [CSS][].

## Install
{%= include("install-npm", {save: true}) %}

## Usage examples

```js
var Snapdragon = require('{%= name %}');
var snapdragon = new Snapdragon();
```

**Parse**

```js
var ast = snapdragon.parser('some string', options)
  // parser middleware that can be called by other middleware
  .set('foo', function () {})
  // parser middleware that will be run immediately, in the order defined
  .use(bar())
  .use(baz())
```

**Render**

```js
// pass the `ast` from the parse method
var res = snapdragon.renderer(ast)
  // renderer middleware, called when the name of the middleware
  // matches the `node.type` (defined in a parser middleware)
  .set('bar', function () {})
  .set('baz', function () {})
  .render()
```

See the [examples](./examples/)

 - [basic](./examples/basic-example.js)
 - [filepath](./examples/filepath-example.js)
 - [sourcemaps](./examples/sourcemaps-example.js)

Try running all three examples from the command line. Just do:

 - `node examples/basic-example.js`
 - `node examples/filepath-example.js`
 - `node examples/sourcemaps-example.js`


## Getting started

**Parsers**

Parsers are middleware functions used for parsing a string into an ast node.

```js
var ast = snapdragon.parser(str, options)
  .use(function() {
    var pos = this.position();
    var m = this.match(/^\./);
    if (!m) return;
    return pos({
      // `type` specifies the renderer to use
      type: 'dot',
      val: m[0]
    });
  })
```

**AST node**

When the parser finds a match, `pos()` is called, pushing a node onto the ast that looks something like:

```js
{ type: 'dot',
  val: '.',
  position:
   { start: { line: 1, column: 1 },
     end: { line: 1, column: 2 } }
```

**Renderers**

Renderers are middleware functions that visit over an array of ast nodes to render a string.

```js
var res = snapdragon.renderer(ast)
  .set('dot', function (node) {
    console.log(node.val)
    //=> '.'
    return this.emit(node.val);
  })
```

## Docs

### Parsers

A parser middleware is a function that returns an abject called a `token`. This token is pushed onto the AST as a node.

**Example token**

```js
{ type: 'dot',
  val: '.',
  position:
   { start: { line: 1, column: 1 },
     end: { line: 1, column: 2 } }
```

**Example parser middleware**

Match a single `.` in a string:

  1. Get the starting position by calling `this.position()`
  1. pass a regex for matching a single dot to the `.match` method
  1. if **no match** is found, return `undefined`
  1. if a **match** is found, `pos()` is called, which returns a token with:
      * `type`: the name of the [renderer] to use
      * `val`: The actual value captured by the regex. In this case, a `.`. Note that you can capture and return whatever will be needed by the corresponding [renderer].
      * The ending position: automatically calculated by adding the length of the first capture group to the starting position. 

```js
function dot() {
  var pos = this.position();
  var m = this.match(/^\./);
  if (!m) return;
  return pos({
    type: 'dot',
    val: m[0]
  })
}
```



_(TBC)_

## TODO

- [x] getting started
- [ ] docs for `.use`
- [ ] docs for `.set` 
- [ ] docs for child `nodes` (recursion)
- [ ] unit tests
- [ ] benchmarks


## Related projects

Snapdragon was inspired by these great projects by [tj](https://github.com/tj):

{%= related(['jade', 'css']) %}

## Running tests
{%= include("tests") %}

## Contributing
{%= include("contributing") %}

## Authors
{%= include("author") %}

**Brian Woodward**

+ [github/doowb](https://github.com/doowb)
+ [twitter/doowb](http://twitter.com/doowb)

## License
{%= copyright() %}
{%= license() %}

***

{%= include("footer") %}

{%= reflinks(['jade', 'css']) %}  
